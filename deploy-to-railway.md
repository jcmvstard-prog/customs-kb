# Deploy to Railway - One-Click Guide

Railway.app is the recommended platform for deploying the US Customs Knowledge Base.

## Why Railway?

- ✅ Native Docker Compose support
- ✅ Automatic GitHub integration
- ✅ Free tier: $5 credit/month (500 execution hours)
- ✅ One-click deployment
- ✅ Automatic PostgreSQL + Redis provisioning

---

## One-Click Deploy

### Step 1: Click Deploy Button

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/customs-kb?referralCode=bonus)

Or manually:

1. Go to: https://railway.app/new
2. Sign in with GitHub
3. Click "Deploy from GitHub repo"
4. Select: `jcmvstard-prog/customs-kb`

### Step 2: Configure Services

Railway will automatically detect `docker-compose.yml` and create:

- **PostgreSQL** - Database service
- **Qdrant** - Vector database service
- **App** - Python application

### Step 3: Set Environment Variables

Railway will prompt for these (or auto-generate):

```
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_USER=customs_user
POSTGRES_DB=customs_kb
FEDERAL_REGISTER_AGENCY=u-s-customs-and-border-protection
```

All other variables use smart defaults from `.env.example`.

### Step 4: Deploy!

Click "Deploy" - Railway will:
1. Build Docker containers
2. Start PostgreSQL + Qdrant
3. Initialize databases
4. Start application
5. Provide public URL

**Deployment time**: 3-5 minutes

---

## Post-Deployment

### Access Your Application

Railway provides a public URL: `https://customs-kb-production.up.railway.app`

### Initialize Data

SSH into Railway console or use Railway CLI:

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link to your project
railway link

# Run commands
railway run python -m src.cli.main ingest htsus
railway run python -m src.cli.main ingest federal-register --start-date 2024-01-01 --end-date 2024-12-31
```

### Check Status

```bash
railway run python -m src.cli.main ingest status
```

---

## Monitoring

### Railway Dashboard

- View logs: `railway logs`
- Check metrics: CPU, memory, requests
- Monitor database size
- View deployments history

### Health Checks

Application includes built-in health checks:
- Database connectivity
- Qdrant availability
- Embedding model loaded

---

## Costs

### Free Tier
- $5 credit per month
- 500 execution hours
- Perfect for POC and testing

### Paid Plans
- **Developer**: $5/mo
- **Team**: $20/mo
- Pay-as-you-go for resources

### Estimated Usage
- PostgreSQL: ~$0.01/hour
- Qdrant: ~$0.01/hour
- App: ~$0.01/hour
- **Total**: ~$22/month for 24/7 operation

---

## Scaling

### Vertical Scaling
- Increase memory/CPU in Railway dashboard
- Add more storage for PostgreSQL/Qdrant

### Horizontal Scaling
- Add multiple app instances
- Railway auto-load balancing

---

## Alternative: Railway CLI Deployment

If you prefer CLI:

```bash
# Install
npm install -g @railway/cli

# Login
railway login

# Initialize
cd ~/my-new-project/customs-kb
railway init

# Deploy
railway up

# Add services
railway add --service postgres
railway add --service qdrant

# Link services
railway variables --set POSTGRES_HOST=${{POSTGRES.HOST}}
railway variables --set QDRANT_HOST=${{QDRANT.HOST}}

# Deploy
railway up
```

---

## Troubleshooting

### Build Failures
- Check Dockerfile syntax
- Verify requirements.txt
- Check Railway build logs

### Connection Issues
- Verify environment variables
- Check service health in dashboard
- Review application logs

### Out of Memory
- Increase memory allocation
- Optimize embedding model loading
- Add swap space

---

## Support

- Railway Discord: https://discord.gg/railway
- Railway Docs: https://docs.railway.app
- Project Issues: https://github.com/jcmvstard-prog/customs-kb/issues

---

**Deployment Guide Updated**: January 30, 2026
**Status**: Ready to Deploy
**Estimated Setup Time**: 5 minutes
